<div class="app-bar">
    <div class="app-bar-left">
        <div class="app-actions">
            <button class="action-button" (click)="handleMainMenuClick($event)" title="Main Menu">
                <i class="bi bi-list"></i>
            </button>
            <button class="action-button" (click)="onBtnAIAssistant.emit()" title="AI Assistant">
                <i class="bi bi-robot"></i>
            </button>
            <button class="action-button" (click)="toggleRecentApps($event)" title="Recent Apps">
                <i class="bi bi-clock-history"></i>
            </button>
        </div>
    </div>
    
    <div class="app-bar-center">
        <div class="search-container">
            <i class="bi bi-search search-icon"></i>
            <input type="text" 
                   class="search-input" 
                   placeholder="Search URL or App"
                   [value]="currentTab?.url || ''"
                   (click)="onEnteredSearchBox.emit()"/>
            <button type="button" class="btn btn-add" (click)="onBtnAddApp.emit()" title="Add new app">
                <i class="bi bi-plus"></i>
            </button>
        </div>
    </div>

    <div class="app-bar-right">
        <div class="app-list">
            <ng-container *ngFor="let app of apps">
                <div class="app-group"
                     [class.active]="currentApp?.id === app.id">
                    <!-- App Header -->
                    <div class="app-header"
                         (click)="handleAppSelect(app)"
                         (contextmenu)="handleContextMenu(app)"
                         (dblclick)="handleAppBarDoubleClick($event)">
                        <img [src]="app.icon" *ngIf="app.icon" class="app-icon" alt=""/>
                        <i *ngIf="!app.icon" class="bi bi-window app-icon"></i>
                        <span class="app-title">{{getHost(app)}}</span>
                        <button class="app-close" 
                                (click)="handleAppClose($event, app)"
                                title="Close app">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                    
                    <!-- App Tabs -->
                    <div class="app-tabs" *ngIf="currentApp?.id === app.id">
                        <div class="tab-list">
                            <div class="tab-item"
                                 *ngFor="let tab of getAppTabs(app)"
                                 [class.active]="currentTab?.id === tab.id"
                                 (click)="handleTabSelect(tab)"
                                 (contextmenu)="handleTabContextMenu($event, tab)">
                                <img [src]="tab.icon" *ngIf="tab.icon" class="tab-icon" alt=""/>
                                <i *ngIf="!tab.icon" class="bi bi-file-earmark tab-icon"></i>
                                <span class="tab-title">{{tab.title || tab.hostName}}</span>
                                <button class="tab-close"
                                        (click)="handleTabClose($event, tab)"
                                        title="Close tab">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                            <button class="new-tab-btn" (click)="handleNewTab()" title="New Tab">
                                <i class="bi bi-plus-lg"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </ng-container>
        </div>
    </div>

    <div class="window-controls" (contextmenu)="handleWindowControlsContextMenu($event)">
        <button class="window-button minimize" title="Minimize" (click)="handleMinimize()">
            <i class="bi bi-dash-lg"></i>
        </button>
        <button class="window-button maximize" title="Maximize" (click)="handleMaximize()">
            <i class="bi bi-square"></i>
        </button>
        <button class="window-button close" title="Close" (click)="handleClose()">
            <i class="bi bi-x-lg"></i>
        </button>
    </div>
</div>

<div class="recent-apps-dropdown" *ngIf="showRecentApps">
    <div class="recent-apps-header">
        <h3>Recent Apps</h3>
        <button class="close-button" (click)="toggleRecentApps($event)">
            <i class="bi bi-x"></i>
        </button>
    </div>
    <div class="recent-apps-content">
        <div class="recent-apps-list" *ngIf="recentApps.length > 0">
            <div class="recent-app-item" *ngFor="let app of getUniqueHosts(recentApps)" (click)="handleRecentAppClick(app)">
                <img [src]="app.icon" *ngIf="app.icon" class="app-icon" alt=""/>
                <i *ngIf="!app.icon" class="bi bi-window app-icon"></i>
                <div class="app-info">
                    <div class="app-title">{{app.host}}</div>
                </div>
            </div>
        </div>
        <div class="no-recent-apps" *ngIf="recentApps.length === 0">
            <i class="bi bi-clock"></i>
            <p>No recent apps</p>
        </div>
    </div>
</div>