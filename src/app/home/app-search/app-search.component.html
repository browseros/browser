<div class="search-modal" [class.show]="isVisible">
    <div class="search-container" #searchBox>
        <div class="search-header">
            <button type="button" class="close" (click)="hide()" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            <div class="search-input-wrapper">
                <input #searchInput
                       type="text"
                       class="search-input"
                       [(ngModel)]="searchText"
                       (keyup)="keyUp($event)"
                       (input)="onSearchChanged()"
                       placeholder="Type to search...">
                <i class="bi bi-search"></i>
            </div>
        </div>

        <div class="search-results">
            <!-- Google Search -->
            <div class="search-section" *ngIf="searchText">
                <div class="search-item" [class.active]="isCurrentSelectedSearchItem(0)" (click)="doGoogleSearch(searchText)">
                    <i class="bi bi-google search-item-icon"></i>
                    <div class="search-item-content">
                        <div class="search-item-title">Search Google for "{{searchText}}"</div>
                    </div>
                </div>
            </div>

            <!-- Search Suggestions -->
            <div class="search-section" *ngIf="suggestions.length > 0">
                <div class="search-section-title">Suggestions</div>
                <div class="search-item" *ngFor="let suggestion of suggestions; let i = index"
                     [class.active]="isCurrentSelectedSearchItem(i + 1)"
                     (click)="handleSuggestionClick(suggestion)">
                    <img [src]="suggestion.icon" *ngIf="suggestion.icon" class="search-item-icon" alt="">
                    <i *ngIf="!suggestion.icon" class="bi bi-search search-item-icon"></i>
                    <div class="search-item-content">
                        <div class="search-item-title">{{suggestion.title}}</div>
                        <div class="search-item-url" *ngIf="suggestion.link">{{suggestion.link}}</div>
                    </div>
                </div>
            </div>

            <!-- History Results -->
            <div class="search-section" *ngIf="historiesSearched.length > 0">
                <div class="search-section-title">Recent</div>
                <div class="search-item" *ngFor="let item of historiesSearched"
                     (click)="selectHistoryItem(item)">
                    <img [src]="item.icon" *ngIf="item.icon" class="search-item-icon" alt="">
                    <i *ngIf="!item.icon" class="bi bi-clock-history search-item-icon"></i>
                    <div class="search-item-content">
                        <div class="search-item-title">{{item.title}}</div>
                        <div class="search-item-url">{{item.link}}</div>
                    </div>
                </div>
            </div>

            <!-- Top Apps -->
            <div class="search-section" *ngIf="!searchText && topApps.length > 0">
                <div class="search-section-title">Frequently Used</div>
                <div class="search-item" *ngFor="let app of topApps"
                     (click)="selectHistoryItem(app)">
                    <img [src]="app.icon" *ngIf="app.icon" class="search-item-icon" alt="">
                    <i *ngIf="!app.icon" class="bi bi-window search-item-icon"></i>
                    <div class="search-item-content">
                        <div class="search-item-title">{{app.title}}</div>
                        <div class="search-item-url">{{app.link}}</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="search-footer">
            <div class="keyboard-hint">
                <kbd>↑</kbd><kbd>↓</kbd> to navigate
                <kbd>Enter</kbd> to select
                <kbd>Esc</kbd> to close
            </div>
            <div>
                <button type="button" class="btn btn-default" (click)="hide()">Cancel</button>
                <button type="button" class="btn btn-primary" (click)="doSearch(searchText)">
                    <i class="bi bi-search"></i>Search
                </button>
            </div>
        </div>
    </div>
</div>
